---
title: "Tutorial 2"
output: html_notebook
---

Voc√™ entra em um est√°gio de pesquisa no Centro de Estudos de Microfinan√ßas e Inclus√£o Financeira (Cemif)1. Uma das pesquisadoras afiliadas ao Cemif te convida para trabalhar em um projeto de acesso a cr√©dito de pequenas e m√©dias empresas usando os dados do World Bank Enterprise Surveys (WBES)2, coletados no Brasil em 2009. A base de dados, brasil2009.csv, e o dicion√°rio das vari√°veis est√£o na pasta do tutorial 2.

```{r}
library(tidyverse)
brasil <- read_csv("brasil2009.csv")
```


A pesquisadora diz que a base n√£o foi tratada e precisa de alguns ajustes. Por exemplo, as respostas s√£o codificadas com n√∫meros negativos quando a(o) respondente n√£o sabe (-9) ou se recusa a responder (-7). Para isso, voc√™ precisa transformar os n√∫meros negativos em dados faltantes (NA). Um exemplo para fazer esta transforma√ß√£o usando o R est√° abaixo para a vari√°vel d2 (faturamento total anual). Voc√™s v√£o precisar usar o c√≥digo abaixo para outras vari√°veis.

```{r, warning=F, message=F}
brasil$d2 <- ifelse(brasil$d2 < 0, NA, brasil$d2)
```

A coordenadora do centro te pede um apoio. Ela est√° interessada em examinar o **impacto de investir em ativos fixos na produtividade do trabalho em pequenas e m√©dias empresas (PMEs)**. Voc√™ nota que a vari√°vel produtividade do trabalho n√£o est√° dispon√≠vel na sua base de dados. No entanto, alguns estudos utilizam como proxy para produtividade o
faturamento anual (vari√°vel d2) dividido pelo n√∫mero de funcion√°rios (vari√°vel l1 ‚Äì leia- se letra l min√∫scula e n√∫mero 1) (Amin e Okou, 2020; Motta, 2020; Kouam√© e Tapsoba, 2019; Friesen e Wacker, 2019). Voc√™ cria essa vari√°vel

```{r}
brasil$l1 <- ifelse(brasil$l1 < 0, NA, brasil$l1)

brasil <- brasil %>% 
  mutate(produtividade = d2/l1,
         logprodutividade = log(produtividade))

is.na(brasil) <- sapply(brasil, is.infinite) # transformando todos os - Inf # em missing data (NA)
```

_Verificar produtividade_
```{r}
#hist(brasil$produtividade)
hist(brasil$logprodutividade)

```


#### PERGUNTA 1

Voc√™ estima uma regress√£o simples do impacto da empresa ter realizado
investimentos em ativos fixos (vari√°vel k4) no **logaritmo da produtividade da empresa**, e **interprete o resultado**. Na base, est√° vari√°vel dummy √© igual a 1 para ‚ÄúSim‚Äù e 2 para ‚ÄúN√£o‚Äù. Voc√™ ajusta essa vari√°vel e coloca 0 para ‚ÄúN√£o‚Äù ao inv√©s de 2. (Dica: vari√°veis dummies s√£o codificadas como 1 ou 0. Desta maneira, voc√™ vai ter que transformar o 2 (N√£o) em 0 al√©m de transformar os n√∫meros negativos em NAs)

```{r}
brasil$k4 <- ifelse(brasil$k4 < 0, NA, brasil$k4)
brasil$k4 <- ifelse(brasil$k4 == 2, 0, brasil$k4)

mqo <- lm(logprodutividade ~ k4, data = brasil)

summary(mqo)
```
**Resposta:**
??A interpretacao muda, pois nao tenho mais y, tenho log(y), assim um aumento de uma unidade de x nao leva a um aumento esperado de b1 em y. Aumentar 1 unidade X leva um aumento relativo de b1*100% em y
??(Coment√°rios: Em caso de modelo linear log, onde y se mant√©m e o log ocorre nas vari√°veis independentes Interpretacao aproximada/relativa. aumentar 1% induz um aumento ou diminuicao de b1/100 unidades em y)

Entao a an√°lise da mudanca √©
`y = b0 + b1x1`

y = log(produtividade)
x = realizacao de investimento

log(produtividade) = 10,14 + 0.52*100x

Entao, para caso ocorra investimentos em ativos fixos, o aumento relativo da produtividade √© em 52%

#### PERGUNTA 2
Voc√™ mostra o resultado acima para a coordenadora e ela comenta que voc√™ n√£o pode fazer afirma√ß√µes sobre o efeito do investimento na produtividade sem considerar que voc√™ est√° trabalhando apenas com uma amostra. Voc√™ n√£o
entende bem o que ela quer dizer e ela te sugere fazer uma pesquisa sobre p-valores e o teste t para coeficientes de regress√£o. Voc√™ interpreta o coeficiente do investimento e teste hip√≥tese nula 

ùêª0 : ùõΩùëñùëõùë£ùëíùë†ùë°ùëñùëöùëíùëõùë°ùëú = 0 
contra a hip√≥tese alternativa 
ùêªùëé : ùõΩùëñùëõùë£ùëíùë†ùë°ùëñùëöùëíùëõùë°ùëú ‚â† 0 . 

Qual o valor da estat√≠stica t? Podemos rejeitar a hip√≥tese nula para um n√≠vel de signific√¢ncia de 5%?

**Resposta:**
H0 significa que o investimento nao foi feito
H1 significa que o investimento foi feito

```{r}
t.test(logprodutividade ~ k4, data = brasil)
```
O p-valor √© inferior a 5%, logo quem recebe investimento e quem nao recebe possui diferenca significativa entre as m√©dias.
Podemos assumir a hip√≥tese H0 como falsa.

O valor de T √© -4.47 (O que isso significa?)

#### PERGUNTA 3
A pesquisadora do Cemif sugere que voc√™ inclua outras vari√°veis de controle no seu modelo. Ela sugere dar uma olhada no paper Islam, Gaddis, Palacios L√≥pez e Amin (2020) para ter ideias sobre potenciais vari√°veis de controle. **Por exemplo,a idade da empresa pode estar associada √† produtividade**. No entanto, a base possui apenas o ano em que a empresa iniciou sua opera√ß√£o (b5). Voc√™ uma vari√°vel de idade da firma igual a diferen√ßa entre o ano fiscal atual (2007) e o ano em que a empresa iniciou sua opera√ß√£o. **Al√©m da idade, voc√™ coloca outras vari√°veis de controle que podem impactar a produtividade do trabalho da firma**

```{r}
brasil$b5 <- ifelse(brasil$b5 < 0, NA, brasil$b5)

brasil <- brasil %>% 
  mutate(idade_firma = 2007-b5)

```

Corrigindo outras vari√°veis
```{r}

```

Rodando o modelo
```{r}
mqo2 <- lm(logprodutividade ~ k4+idade_firma, data = brasil)

summary(mqo)
```


#### PERGUNTA 4
Conhecendo o conceito de p-valor, voc√™ observa que a sa√≠da do R do resumo do modelo na quest√£o anterior apresenta, al√©m dos testes t para os coeficientes, um teste F para o modelo como um todo. Para completar seu relat√≥rio deste primeiro projeto, voc√™ vai pesquisar sobre esse teste F. Qual a hip√≥tese nula do teste? Como interpretar a rejei√ß√£o ou n√£o-rejei√ß√£o desse teste?

**Resposta:**
Teste-f √© usado para comparar a variancia. Comparar a variancia entre grupos, quadrado m√©dio dos res√≠duos.

Comparar a variancia de dois grupos.
Exige normalidade dos dados quando homogeneidade de variancia.
H0 x e y possuem a mesma variancia?

Rejeitamos um H0 quando o valor do pvalor √© menor que 1%

```{r}
var.test()
```


#### PERGUNTA 5
Voc√™ nota que na sa√≠da do R do resumo do modelo aparece uma coluna
denominada erro padr√£o (Std. Error). Um outro estudante n√£o entende muito
bem o que √© o erro-padr√£o e voc√™ explica para ele, falando tamb√©m sobre a
rela√ß√£o do erro padr√£o com o p-valor dos testes t.

**Resposta:**


#### PERGUNTA 6
O g√™nero da(o) propriet√°ria(o) pode ser um preditor do faturamento anual, pois existem diferen√ßas no faturamento entre empresas lideradas por mulheres e homens (Islam, Gaddis, Palacios L√≥pez e Amin, 2020). Voc√™ cria a vari√°vel bin√°ria (dummy) igual a 1 se existe ao menos uma mulher propriet√°ria (b4) no modelo de regress√£o anterior e sugere que talvez seja interessante estimar se o impacto de um ano a mais de experi√™ncia em gest√£o (b7) na produtividade do trabalho √© o mesmo para mulheres e homens em cargos de dire√ß√£o (b7a). Voc√™ estima o modelo abaixo:

log(ùëùùëüùëúùëëùë¢ùë°ùëñùë£ùëñùëëùëéùëëùëí) = ùõΩ0 + ùõΩ1ùëíùë•ùëù + ùõΩ2ùëöùë¢ùëô‚Ñéùëíùëü + ùõΩ3ùëíùë•ùëù ‚àó ùëöùë¢ùëô‚Ñéùëíùëü

onde log(faturamento) √© o logaritmo natural do faturamento anual, exp √© a
experi√™ncia do(a) gestor (a) na √°rea de atua√ß√£o (em anos), e mulher √© uma
vari√°vel dummy igual a 1 se a diretora principal for mulher (0 caso contr√°rio).
Voc√™ interpreta o coeficiente do termo de intera√ß√£o entre experi√™ncia e mulher

```{r}
brasil$b7a <- ifelse(brasil$b7a < 0, NA, brasil$b7a)
brasil$b7a <- ifelse(brasil$b7a == 2, 0, brasil$b7a)

brasil$b7 <- ifelse(brasil$b7 < 0, NA, brasil$b7)

brasil <- brasil %>% 
  mutate(logfaturamento = log(d2))

```

Modelo
```{r}
mqo3 <- lm(logfaturamento ~ b7 + b7a + I(b7*b7a), data = brasil)
summary(mqo3)
```

**Resposta:**


#### PERGUNTA 7
Uma estudante em fase de t√©rmino mestrado acad√™mico comenta com o grupo
que sua disserta√ß√£o consiste em examinar o impacto da competi√ß√£o no mercado informal no faturamento da empresa. Um estudo mostra que pequenas e m√©dias empresas (PMEs) s√£o as mais afetadas pela competi√ß√£o com empresas informais (Gonz√°lez e Lamanna, 2007; Distinguin et al, 2016). A pesquisadora acha interessante e pede para voc√™ estimar o modelo abaixo:

log(ùëìùëéùë°ùë¢ùëüùëéùëöùëíùëõùë°ùëú) = ùõΩ0 + ùõΩ1ùëñùëõùëìùëúùëüùëöùëéùëô + ùõΩ2ùëùùëöùëí + ùõΩ3ùëñùëõùëìùëúùëüùëöùëéùëô ‚àó ùëùùëöùëí

onde log(faturamento) √© o logaritmo natural do faturamento anual, informal
(e11) √© uma vari√°vel dummy igual a 1 se a empresa compete com empresas
informais (0 caso contr√°rio), e pme √© uma vari√°vel dummy igual a 1 se a
empresa √© de pequeno e m√©dio porte (0 caso contr√°rio). De acordo com a
defini√ß√£o do Banco Mundial, a vari√°vel pme pode ser constru√≠da da seguinte forma: ela vai ser igual a 1 se a vari√°vel do n√∫mero de funcion√°rios em tempo integral (l1) for menor do que 100 (0 caso contr√°rio). Calcule as diferen√ßas no faturamento, em percentual, entre PMEs que competem no mercado informal e as categorias abaixo:
a. PMEs que n√£o competem no mercado informal
b. Empresas grandes que competem no mercado informal
c. Empresas grandes que n√£o competem no mercado informal


```{r}
brasil$e11 <- ifelse(brasil$e11 < 0, NA, brasil$e11)
brasil$e11 <- ifelse(brasil$e11 == 2, 0, brasil$e11)

brasil <- brasil %>% 
  mutate(pme = case_when(l1 < 100 ~ 1,
                         TRUE ~ 0))

```

Modelo
```{r}
mqo4 <- lm(logprodutividade ~ e11 + pme + I(e11*pme), data = brasil)
summary(mqo4)
```

x: 0 nao compete com empresas informais , 1  compete com empresas informais 
z: 0 grande, 1 pme

`y = B0 + B1x + B2z + B3xz`

nao compete e √© grande y = B0 
nao compete e √© pme:  y = B0 + B2 
compete e √© grande: y = B0 + B1
compete e √© pme: y = B0 + B1 + B2 + B3

##### PERGUNTA 7a
PMEs que n√£o competem no mercado informal


##### PERGUNTA 7b
Empresas grandes que competem no mercado informal

##### PERGUNTA 7c
Empresas grandes que n√£o competem no mercado informal